<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Model Context Protocol (MCP) Implementation</title>
    <style>
      body { margin: 0; padding: 48px 20px; font-family: "Helvetica Neue", Arial, sans-serif; background: #f7f4ef; color: #1f1b16; }
      main { max-width: 920px; margin: 0 auto; background: #fffdf9; padding: 48px; border: 1px solid #e3d8c7; box-shadow: 6px 8px 0 #e3d8c7; }
      h1, h2, h3 { font-weight: 600; margin-top: 2rem; }
      pre { background: #1f1b16; color: #f7f4ef; padding: 16px; overflow: auto; }
      code { font-family: "SFMono-Regular", ui-monospace, Menlo, Monaco, Consolas, monospace; }
      a { color: #8a3b12; }
      img { max-width: 100%; height: auto; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #e3d8c7; padding: 8px; }
    </style>
  </head>
  <body>
    <main>
      <h1>Model Context Protocol (MCP) Implementation</h1>
<pre><code class="language-sh">claude mcp add tia-agents npx -y -p tia-agents node ./node_modules/tia-agents/src/mcp/servers/Echo.js
</code></pre>
<p>or</p>
<pre><code class="language-sh">codex mcp add tia-agents npx -y -p tia-agents node ./node_modules/tia-agents/src/mcp/servers/Echo.js
</code></pre>
<p>[mcp_servers.tia-agents]
command = &quot;node&quot;
args = [&quot;/home/danny/hyperdata/tia/src/mcp/servers/Echo.js&quot;]</p>
<p>claude mcp add tia-agents node /home/danny/hyperdata/tia/src/mcp/servers/Echo.js</p>
<p> File modified: /home/danny/.claude.json [project: /home/danny/hyperdata/tia]</p>
<p>codex mcp add tia-agents --env TIA_ENV_PATH=/home/danny/hyperdata/tia/.env -- node /home/danny/hyperdata/tia/src/mcp/servers/Echo.js</p>
<p>[mcp_servers.tia-agents]
command = &quot;npx&quot;
args = [&quot;-y&quot;, &quot;-p&quot;, &quot;tia-agents&quot;, &quot;node&quot;, &quot;-e&quot;, &quot;import(&#39;tia-agents/src/mcp/servers/Echo.js&#39;)&quot;]</p>
<h2>Overview</h2>
<p>This document describes the MCP client and server implementation that enables JSON-RPC 2.0 based communication between processes using standard input/output.</p>
<h2>Client (client.js)</h2>
<h3>Features</h3>
<ul>
<li>Connects to the MCP server using stdio</li>
<li>Sends JSON-RPC 2.0 formatted requests</li>
<li>Handles responses and errors asynchronously</li>
<li>Provides an interactive command-line interface</li>
</ul>
<h3>Usage</h3>
<pre><code class="language-bash">node src/mcp/client.js
</code></pre>
<h3>Available Commands</h3>
<ul>
<li><code>help</code> - Show available commands</li>
<li><code>exit</code> or <code>quit</code> - Exit the client</li>
</ul>
<h3>Request Format</h3>
<pre><code class="language-json">{
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;id&quot;: &quot;unique-request-id&quot;,
  &quot;method&quot;: &quot;echo&quot;,
  &quot;params&quot;: {
    &quot;message&quot;: &quot;Your message here&quot;
  }
}
</code></pre>
<h2>Server (servers/Echo.js)</h2>
<h3>Features</h3>
<ul>
<li>Implements JSON-RPC 2.0 server over stdio</li>
<li>Handles multiple concurrent requests</li>
<li>Provides echo functionality</li>
<li>Includes comprehensive error handling</li>
</ul>
<h3>Usage</h3>
<pre><code class="language-bash">node src/mcp/servers/Echo.js
</code></pre>
<h3>Supported Methods</h3>
<h4>echo</h4>
<p>Echoes back the received message.</p>
<p><strong>Request:</strong></p>
<pre><code class="language-json">{
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;id&quot;: &quot;unique-request-id&quot;,
  &quot;method&quot;: &quot;echo&quot;,
  &quot;params&quot;: {
    &quot;message&quot;: &quot;Hello, world!&quot;
  }
}
</code></pre>
<p><strong>Response:</strong></p>
<pre><code class="language-json">{
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;id&quot;: &quot;unique-request-id&quot;,
  &quot;result&quot;: {
    &quot;content&quot;: [{
      &quot;type&quot;: &quot;text&quot;,
      &quot;text&quot;: &quot;Echo: Hello, world!&quot;
    }]
  }
}
</code></pre>
<h4>xmppStatus</h4>
<p>Reports XMPP connection state for the debug agent and the last message observed in the room.</p>
<p><strong>Request:</strong></p>
<pre><code class="language-json">{
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;id&quot;: &quot;status-1&quot;,
  &quot;method&quot;: &quot;xmppStatus&quot;
}
</code></pre>
<p><strong>Response:</strong></p>
<pre><code class="language-json">{
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;id&quot;: &quot;status-1&quot;,
  &quot;result&quot;: {
    &quot;connected&quot;: true,
    &quot;room&quot;: &quot;general@conference.xmpp&quot;,
    &quot;nickname&quot;: &quot;McpDebug&quot;,
    &quot;lastIncoming&quot;: {
      &quot;body&quot;: &quot;hello room&quot;,
      &quot;sender&quot;: &quot;alice&quot;,
      &quot;from&quot;: &quot;general@conference.xmpp/alice&quot;,
      &quot;type&quot;: &quot;groupchat&quot;,
      &quot;receivedAt&quot;: &quot;2024-01-01T00:00:00.000Z&quot;
    }
  }
}
</code></pre>
<h4>xmppSend</h4>
<p>Sends a test message to the configured MUC for basic connectivity checks.</p>
<p><strong>Request:</strong></p>
<pre><code class="language-json">{
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;id&quot;: &quot;send-1&quot;,
  &quot;method&quot;: &quot;xmppSend&quot;,
  &quot;params&quot;: {
    &quot;message&quot;: &quot;Test message from MCP&quot;
  }
}
</code></pre>
<p><strong>Response:</strong></p>
<pre><code class="language-json">{
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;id&quot;: &quot;send-1&quot;,
  &quot;result&quot;: {
    &quot;sent&quot;: true,
    &quot;to&quot;: &quot;general@conference.xmpp&quot;,
    &quot;message&quot;: &quot;Test message from MCP&quot;
  }
}
</code></pre>
<h3>XMPP Debug Agent Configuration</h3>
<p>The MCP server (<code>src/mcp/servers/Echo.js</code>) now spins up a lightweight XMPP participant for debugging. Configure it via <code>.env</code>:</p>
<pre><code>XMPP_SERVICE=xmpp://localhost:5222       # or xmpps://host:5222 with NODE_TLS_REJECT_UNAUTHORIZED=0
XMPP_DOMAIN=xmpp
MUC_ROOM=general@conference.xmpp
MCP_BOT_NICKNAME=McpDebug
</code></pre>
<p>XMPP passwords are loaded from <code>config/agents/secrets.json</code> (set <code>AGENT_SECRETS_PATH</code> to override).</p>
<p>On startup the server will join the MUC and log any messages it sees. Use <code>xmppStatus</code> to check join state and last observed message; use <code>xmppSend</code> to post a test message into the room.</p>
<p><code>.env</code> resolution:</p>
<ul>
<li>First looks in the current working directory (or <code>TIA_ENV_PATH</code> if set).</li>
<li>Then falls back to the package root <code>.env</code> (when running from a checkout).</li>
</ul>
<h2>Error Handling</h2>
<h3>Common Error Codes</h3>
<ul>
<li><code>-32600</code>: Invalid Request</li>
<li><code>-32601</code>: Method not found</li>
<li><code>-32602</code>: Invalid params</li>
<li><code>-32603</code>: Internal error</li>
<li><code>-32700</code>: Parse error</li>
</ul>
<h3>Error Response Format</h3>
<pre><code class="language-json">{
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;id&quot;: &quot;request-id&quot;,
  &quot;error&quot;: {
    &quot;code&quot;: -32601,
    &quot;message&quot;: &quot;Method not found&quot;,
    &quot;data&quot;: &quot;Additional error details&quot;
  }
}
</code></pre>
<h2>Implementation Notes</h2>
<h3>Client-Server Communication</h3>
<ul>
<li>Uses newline-delimited JSON (JSONL) for message framing</li>
<li>Each JSON-RPC message must be a single line</li>
<li>Messages are expected to be valid JSON</li>
</ul>
<h3>Dependencies</h3>
<ul>
<li>Node.js (v14+)</li>
<li>No external dependencies required</li>
</ul>
<h3>Logging</h3>
<ul>
<li>Server logs to stderr with <code>[Server]</code> prefix</li>
<li>Client logs debug information with <code>[Client]</code> prefix</li>
<li>Application output is sent to stdout</li>
</ul>
<h2>Example Session</h2>
<ol>
<li><p>Start the server:</p>
<pre><code class="language-bash">$ node src/mcp/servers/Echo.js
[Server] Starting simple MCP echo server
[Server] Ready to accept connections
</code></pre>
</li>
<li><p>Start the client:</p>
<pre><code class="language-bash">$ node src/mcp/client.js
Connected! Type a message or &quot;help&quot; for commands.
echo&gt; hello
Echo: hello
</code></pre>
</li>
<li><p>The server will show the request/response flow:</p>
<pre><code>[Server] Received request: { ... }
[Server] Echoing: hello
[Server] Sending response: { ... }
</code></pre>
</li>
</ol>

    </main>
  </body>
</html>