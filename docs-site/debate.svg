<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 880" width="1200" height="880">
  <defs>
    <style>
      .box { fill: #fff; stroke: #333; stroke-width: 2; }
      .agent { fill: #e3f2fd; }
      .coordinator { fill: #fff3e0; }
      .chair { fill: #f3e5f5; }
      .room { fill: #f3e5f5; stroke-dasharray: 5,5; }
      .text { font-family: Arial, sans-serif; font-size: 14px; text-anchor: middle; }
      .title { font-size: 18px; font-weight: bold; }
      .phase { font-size: 12px; fill: #666; }
      .arrow { fill: none; stroke: #333; stroke-width: 2; marker-end: url(#arrowhead); }
      .debate-arrow { stroke: #8e24aa; stroke-width: 2; }
      .handoff-arrow { stroke: #2196f3; stroke-width: 3; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="30" class="text title">Debate Pre-Flow (Before MFR Dataflow)</text>
  <text x="600" y="55" class="text phase">Tool selection via Chair prior to model construction</text>

  <!-- User/Client -->
  <rect x="500" y="80" width="200" height="60" class="box" rx="5"/>
  <text x="600" y="115" class="text title">User/Client</text>

  <!-- Problem input -->
  <path d="M 600 140 L 600 185" class="arrow"/>
  <text x="720" y="170" class="text phase" text-anchor="start">"Q: ..." or "debate ..."</text>

  <!-- MUC Room (General) -->
  <rect x="450" y="185" width="300" height="80" class="box room" rx="5"/>
  <text x="600" y="215" class="text title">general@conference MUC Room</text>
  <text x="600" y="235" class="text phase">Debate messages and votes</text>

  <!-- Coordinator -->
  <rect x="480" y="295" width="240" height="80" class="box coordinator" rx="5"/>
  <text x="600" y="325" class="text title">Coordinator Agent</text>
  <text x="600" y="345" class="text phase">Starts debate session</text>
  <text x="600" y="360" class="text phase">Tracks timeout + consensus</text>

  <!-- Debate Issue -->
  <path d="M 600 375 L 320 430" class="arrow debate-arrow"/>
  <rect x="160" y="430" width="260" height="70" class="box chair" rx="5"/>
  <text x="290" y="460" class="text title">Chair Agent</text>
  <text x="290" y="480" class="text phase">Announces issue + collects IBIS</text>

  <!-- Debate Participants -->
  <path d="M 320 465 L 520 465" class="arrow debate-arrow"/>
  <rect x="520" y="430" width="220" height="70" class="box agent" rx="5"/>
  <text x="630" y="460" class="text title">Agents + Humans</text>
  <text x="630" y="480" class="text phase">Position / Support / Objection</text>

  <!-- Consensus -->
  <path d="M 630 500 L 630 560" class="arrow debate-arrow"/>
  <rect x="520" y="560" width="220" height="70" class="box chair" rx="5"/>
  <text x="630" y="590" class="text title">Chair Consensus</text>
  <text x="630" y="610" class="text phase">"Consensus reached: use ..."</text>

  <!-- Coordinator Selection -->
  <path d="M 630 630 L 600 680" class="arrow debate-arrow"/>
  <rect x="430" y="680" width="340" height="70" class="box coordinator" rx="5"/>
  <text x="600" y="710" class="text title">Coordinator Selects Agents</text>
  <text x="600" y="730" class="text phase">Requests contributions from selection</text>

  <!-- Handoff -->
  <path d="M 600 750 L 600 790" class="arrow handoff-arrow"/>
  <text x="600" y="815" class="text title">Continue to MFR Dataflow</text>
  <text x="600" y="835" class="text phase">See docs/dataflow.svg</text>
</svg>
